var app = app.module('blog', ['ui.router', 'ngResource']);

function blogController($http, $state) {

    this.rpp = 40;
    this.total = 0;
    this.posts = [];

    var me = this;

    this.list = function (table) {
        var pagination = table.pagination;

        var page = Math.ceil(pagination.start / me.rpp) + 1;

        $http({
            url: 'admin/blog',
            method: 'GET',
            params: {
                page: page
            }
        }).success(function (response) {
            me.posts = response.posts;
            me.total = response.total;
            pagination.numberOfPages = Math.ceil(response.total / me.rpp)
        });
    };
}

function blogDetailController($http, $state, Blog) {

    console.log(Blog.query({page: page}));
    return;

    var id = $state.params.postId;
    var me = this;

    this.load = function (id) {
        //also pass through the locale parameter (not the UI locale, but the input locale for the post itself
        $http({
            url: 'admin/blog/' + id,
            method: 'get',
            params: {
                locale: me.locale
            }
        }).success(function (post) {
            me.post = post;
        });
    };

    this.save = function () {
        $http({
            url: 'admin/blog/' + id,
            method: POST
        });
    };

    if (id)
    {
        this.load(id);
    }
}


var controllers = app.module('blog.controllers', []);
controllers.controller('BlogCtrl', blogController)
    .controller('BlogDetailCtrl', blogDetailController);

var factories = app.module('blog.factories', ['ngResource']);

factories.factory('Blog', function($resource)
{
    return $resource('admin/blog/:postId', null, {
        query: {
            url: 'admin/blog',
            method: 'GET',
            params: {
                page: 1
            }
        },
        show: {
            method: 'GET'
        },
        create: {
            method: 'POST'
        },
        update: {
            method: 'PUT'
        }
    });
});


app.module('blog', ['blog.controllers', 'blog.factory']);